<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moodogram | Biometric Analysis</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Roboto+Mono:wght@300;400;500;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- GSAP for Animation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollToPlugin.min.js"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background: #050505; color: white; }
        
        .cinzel-font { font-family: 'Cinzel', serif; }
        .mono-font { font-family: 'Roboto Mono', monospace; }
        .inter-font { font-family: 'Inter', sans-serif; }
        
        /* Liquid Background Blobs */
        .blob {
            position: absolute;
            filter: blur(80px);
            z-index: 0;
            opacity: 0.6;
            animation: blob-float 10s infinite alternate ease-in-out;
        }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #06b6d4; animation-delay: 0s; } /* Cyan */
        .blob-2 { bottom: -10%; right: -10%; width: 40vw; height: 40vw; background: #84cc16; animation-delay: -2s; } /* Lime */
        .blob-3 { top: 40%; left: 40%; width: 30vw; height: 30vw; background: #f97316; animation-delay: -5s; } /* Orange */

        /* Dark Overlay for Readability */
        .bg-overlay {
            background: rgba(5, 5, 5, 0.4); 
            backdrop-filter: blur(10px);
        }

        @keyframes blob-float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, -50px) scale(1.1); }
        }

        /* Glassmorphism - Standard */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .glass-panel:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* Glassmorphism - Darker for Diagrams */
        .dark-glass-panel {
            background: rgba(0, 0, 0, 0.6); 
            backdrop-filter: blur(24px); 
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.05); 
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8); 
            transition: border-color 0.3s ease;
        }
        .dark-glass-panel:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .glow-text {
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .key {
            transition: border-color 0.2s, box-shadow 0.2s, color 0.2s; 
            box-shadow: 0 0 0px transparent;
        }

        .key.current-target {
            border-color: #FFD700;
            box-shadow: 0 0 15px #FFD700, inset 0 0 10px #FFD700;
            color: #FFD700;
            transform: scale(1.05);
            z-index: 10;
        }

        .key.active {
            border-color: #C0C0C0;
            color: #FFF;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        /* Train styling */
        .train-engine {
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.8));
        }
        
        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }

        /* Biometric Cursor */
        .biometric-cursor {
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32' fill='none' stroke='%2322d3ee' stroke-width='1.5'><circle cx='16' cy='16' r='8'/><line x1='16' y1='4' x2='16' y2='28'/><line x1='4' y1='16' x2='28' y2='16'/></svg>") 16 16, crosshair;
        }

        .underline-watch {
            text-decoration: underline;
            text-decoration-color: #eab308; /* Yellow-500 */
            text-decoration-thickness: 3px;
            color: #fef08a;
        }

        /* Starry Background */
        .stars-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            overflow: hidden;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: twinkle 2s infinite alternate;
        }
        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1.2); }
        }
    </style>
</head>
<body class="bg-black text-white h-screen overflow-hidden">

    <div id="root" class="h-full w-full relative z-10"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        gsap.registerPlugin(ScrollToPlugin);

        const TARGET_PHRASE = "HAPPY BIRTHDAY SAANYA";
        const UNIQUE_CHARS = [...new Set(TARGET_PHRASE.replace(/ /g, '').toUpperCase().split(''))];
        const KEYBOARD_LAYOUT = [
            ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
            ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
            ['Z', 'X', 'C', 'V', 'B', 'N', 'M']
        ];

        // --- COMPONENTS ---

        const BackgroundBlobs = () => (
            <div className="absolute inset-0 overflow-hidden pointer-events-none z-0">
                <div className="blob blob-1"></div>
                <div className="blob blob-2"></div>
                <div className="blob blob-3"></div>
                <div className="absolute inset-0 bg-overlay"></div>
            </div>
        );

        const StarryBackground = () => {
            const containerRef = useRef(null);
            
            useEffect(() => {
                const container = containerRef.current;
                const starCount = 100;
                
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    const x = Math.random() * 100;
                    const y = Math.random() * 100;
                    const size = Math.random() * 2 + 1;
                    const delay = Math.random() * 2;
                    
                    star.style.left = `${x}%`;
                    star.style.top = `${y}%`;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    star.style.animationDelay = `${delay}s`;
                    
                    container.appendChild(star);
                }
            }, []);

            return <div ref={containerRef} className="stars-container animate-fade-in"></div>;
        };

        // --- SVG DIAGRAMS ---
        
        const DiagramKeys = () => (
            <svg viewBox="0 0 200 120" className="w-full h-full overflow-visible">
                <g className="intro-key-group" id="key-1">
                    <rect x="-10" y="-10" width="20" height="20" rx="4" stroke="#06b6d4" strokeWidth="2" fill="rgba(6, 182, 212, 0.1)" className="key-shape" />
                    <text x="0" y="5" textAnchor="middle" fill="#06b6d4" fontSize="10" className="mono-font key-text">A</text>
                </g>
                <g className="intro-key-group" id="key-2">
                     <rect x="-10" y="-10" width="20" height="20" rx="4" stroke="#06b6d4" strokeWidth="2" fill="rgba(6, 182, 212, 0.1)" className="key-shape" />
                     <text x="0" y="5" textAnchor="middle" fill="#06b6d4" fontSize="10" className="mono-font key-text">K</text>
                </g>
                 <g className="intro-key-group" id="key-3">
                     <rect x="-10" y="-10" width="20" height="20" rx="4" stroke="#06b6d4" strokeWidth="2" fill="rgba(6, 182, 212, 0.1)" className="key-shape" />
                     <text x="0" y="5" textAnchor="middle" fill="#06b6d4" fontSize="10" className="mono-font key-text">Z</text>
                </g>
                <circle cx="20" cy="20" r="1" fill="#ffffff" opacity="0.3" />
                <circle cx="180" cy="90" r="1" fill="#ffffff" opacity="0.3" />
                <circle cx="100" cy="60" r="1" fill="#ffffff" opacity="0.2" />
            </svg>
        );

        const DiagramStimulus = ({ activeStage }) => (
            <svg viewBox="0 0 200 200" className="w-full h-full opacity-80">
                <defs>
                    <radialGradient id="hypnoGrad" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                        <stop offset="0%" stopColor="#84cc16" stopOpacity="0" />
                        <stop offset="100%" stopColor="#84cc16" stopOpacity="0.3" />
                    </radialGradient>
                </defs>
                <g className="stimulus-swirl" style={{ display: activeStage === 0 ? 'block' : 'none' }}>
                    <circle cx="100" cy="100" r="90" fill="url(#hypnoGrad)" />
                    <g style={{transformOrigin: '100px 100px', animation: 'spin-slow 10s linear infinite'}}>
                        <circle cx="100" cy="100" r="60" stroke="#84cc16" strokeWidth="1" fill="none" strokeDasharray="10 10" />
                        <circle cx="100" cy="100" r="40" stroke="#84cc16" strokeWidth="2" fill="none" strokeDasharray="20 5" />
                    </g>
                    <g style={{transformOrigin: '100px 100px', animation: 'spin-reverse 15s linear infinite'}}>
                        <circle cx="100" cy="100" r="75" stroke="#a3e635" strokeWidth="0.5" fill="none" strokeDasharray="5 5" />
                        <rect x="98" y="20" width="4" height="10" fill="#84cc16" />
                        <rect x="98" y="170" width="4" height="10" fill="#84cc16" />
                        <rect x="20" y="98" width="10" height="4" fill="#84cc16" />
                        <rect x="170" y="98" width="10" height="4" fill="#84cc16" />
                    </g>
                    <circle cx="100" cy="100" r="10" fill="#ecfccb" />
                </g>
                <g className="stimulus-train" style={{ display: activeStage === 1 ? 'block' : 'none' }}>
                     <path d="M40 110 L160 110 L160 70 L110 70 L110 50 L90 50 L90 70 L40 70 Z" fill="#eab308" />
                     <rect x="120" y="75" width="30" height="25" fill="#713f12" opacity="0.3" />
                     <path d="M50 70 L50 40 L70 35 L70 70" fill="#eab308" />
                     <ellipse cx="60" cy="35" rx="10" ry="3" fill="#713f12" />
                     <path d="M30 110 L40 110 L40 80 Z" fill="#ca8a04" />
                     <circle cx="60" cy="110" r="18" fill="#333" stroke="#713f12" strokeWidth="4" />
                     <circle cx="100" cy="110" r="18" fill="#333" stroke="#713f12" strokeWidth="4" />
                     <circle cx="140" cy="110" r="18" fill="#333" stroke="#713f12" strokeWidth="4" />
                     <rect x="50" y="105" width="100" height="6" fill="#cbd5e1" />
                     <circle cx="55" cy="20" r="5" fill="#fff" opacity="0.4" />
                     <circle cx="65" cy="10" r="8" fill="#fff" opacity="0.3" />
                </g>
                <g className="stimulus-apple" style={{ display: activeStage === 2 ? 'block' : 'none' }}>
                    <path d="M100 150 C 70 150 50 130 50 100 C 50 70 70 50 95 60 C 100 62 100 62 105 60 C 130 50 150 70 150 100 C 150 130 130 150 100 150" fill="#ef4444" />
                    <path d="M100 60 Q 105 40 120 30" stroke="#3f6212" strokeWidth="4" fill="none" />
                    <ellipse cx="120" cy="50" rx="15" ry="8" fill="#84cc16" transform="rotate(-30 120 50)" />
                    <path d="M70 90 Q 80 80 90 90" stroke="#fff" strokeWidth="3" opacity="0.4" fill="none" strokeLinecap="round" />
                </g>
            </svg>
        );

        const DiagramNetwork = () => (
            <svg viewBox="0 0 300 150" className="w-full h-full">
                <g stroke="#334155" strokeWidth="1" fill="none" opacity="0.6">
                    <path className="neuron-path" d="M40 40 C 80 40, 100 30, 140 30" />
                    <path className="neuron-path" d="M40 40 C 80 40, 100 60, 140 60" />
                    <path className="neuron-path" d="M40 40 C 80 40, 100 90, 140 90" />
                    <path className="neuron-path" d="M40 75 C 80 75, 100 30, 140 30" />
                    <path className="neuron-path" d="M40 75 C 80 75, 100 60, 140 60" />
                    <path className="neuron-path" d="M40 75 C 80 75, 100 90, 140 90" />
                    <path className="neuron-path" d="M40 75 C 80 75, 100 120, 140 120" />
                    <path className="neuron-path" d="M40 110 C 80 110, 100 60, 140 60" />
                    <path className="neuron-path" d="M40 110 C 80 110, 100 120, 140 120" />
                </g>
                <g stroke="#334155" strokeWidth="1" fill="none" opacity="0.6">
                    <path className="neuron-path" d="M140 30 C 200 30, 220 50, 260 50" />
                    <path className="neuron-path" d="M140 60 C 200 60, 220 50, 260 50" />
                    <path className="neuron-path" d="M140 60 C 200 60, 220 100, 260 100" />
                    <path className="neuron-path" d="M140 90 C 200 90, 220 50, 260 50" />
                    <path className="neuron-path" d="M140 90 C 200 90, 220 100, 260 100" />
                    <path className="neuron-path" d="M140 120 C 200 120, 220 100, 260 100" />
                </g>
                <circle cx="40" cy="40" r="6" fill="#0ea5e9" />
                <circle cx="40" cy="75" r="6" fill="#0ea5e9" />
                <circle cx="40" cy="110" r="6" fill="#0ea5e9" />
                <circle cx="140" cy="30" r="5" fill="#8b5cf6" />
                <circle cx="140" cy="60" r="5" fill="#8b5cf6" />
                <circle cx="140" cy="90" r="5" fill="#8b5cf6" />
                <circle cx="140" cy="120" r="5" fill="#8b5cf6" />
                <circle cx="260" cy="50" r="8" fill="#3b82f6" />
                <circle cx="260" cy="100" r="8" fill="#3b82f6" />
            </svg>
        );


        const IntroPage = ({ onStart }) => {
            const containerRef = useRef(null);
            const proceedButtonRef = useRef(null);
            const [stimulusStage, setStimulusStage] = useState(0); 
            const keyFloatTweens = useRef([]);

            useEffect(() => {
                gsap.fromTo(containerRef.current, 
                    { opacity: 0, y: 20 }, 
                    { opacity: 1, y: 0, duration: 1, ease: "power2.out" }
                );

                const keys = document.querySelectorAll('.intro-key-group');
                keys.forEach((key, i) => {
                    gsap.set(key, { transformOrigin: "center center" });
                    const moveX = gsap.to(key, {
                        x: "random(20, 180)", duration: "random(10, 20)", repeat: -1, yoyo: true, ease: "sine.inOut", delay: i * 2
                    });
                    const moveY = gsap.to(key, {
                        y: "random(20, 100)", duration: "random(8, 15)", repeat: -1, yoyo: true, ease: "sine.inOut", delay: i * 1.5
                    });
                    const rotate = gsap.to(key, {
                        rotation: "random(-180, 180)", duration: "random(15, 30)", repeat: -1, ease: "none"
                    });
                    keyFloatTweens.current.push(moveX, moveY, rotate);
                });
                return () => keyFloatTweens.current.forEach(t => t.kill());
            }, []);

            const scrollToBottom = () => {
                if(containerRef.current && proceedButtonRef.current) {
                    gsap.to(containerRef.current, {
                        duration: 1.5, scrollTo: { y: proceedButtonRef.current, offsetY: 50 }, ease: "power3.inOut"
                    });
                }
            }

            const handleKeysHover = (e) => {
                const shapes = e.currentTarget.querySelectorAll('.key-shape');
                const texts = e.currentTarget.querySelectorAll('.key-text');
                gsap.to(shapes, { stroke: "#FFD700", fill: "rgba(255, 215, 0, 0.2)", filter: "drop-shadow(0 0 8px #FFD700)", duration: 0.1 });
                gsap.to(texts, { fill: "#FFD700", duration: 0.1 });
            };

            const handleKeysLeave = (e) => {
                const shapes = e.currentTarget.querySelectorAll('.key-shape');
                const texts = e.currentTarget.querySelectorAll('.key-text');
                gsap.to(shapes, { stroke: "#06b6d4", fill: "rgba(6, 182, 212, 0.1)", filter: "none", duration: 0.5 });
                gsap.to(texts, { fill: "#06b6d4", duration: 0.5 });
            };

            const handleStimulusHover = (e) => {
                const container = e.currentTarget;
                gsap.to(container, {
                    scaleX: 0, duration: 0.4, ease: "power2.in",
                    onComplete: () => {
                        setStimulusStage(prev => (prev + 1) % 3);
                        gsap.to(container, { scaleX: 1, duration: 0.4, ease: "power2.out" });
                    }
                });
            };

            const handleNetworkHover = (e) => {
                const paths = e.currentTarget.querySelectorAll('.neuron-path');
                gsap.to(paths, {
                    stroke: "#FCD34D", strokeWidth: 2, opacity: 1, filter: "drop-shadow(0 0 2px #FCD34D)", duration: 0.1,
                    stagger: { each: 0.05, from: "random", repeat: -1, yoyo: true }
                });
            };
            const handleNetworkLeave = (e) => {
                const paths = e.currentTarget.querySelectorAll('.neuron-path');
                gsap.killTweensOf(paths);
                gsap.to(paths, { stroke: "#334155", strokeWidth: 1, opacity: 0.6, filter: "none", duration: 0.5 });
            };

            return (
                <div ref={containerRef} className="biometric-cursor h-full w-full overflow-y-auto custom-scroll flex flex-col items-center p-6 md:p-12 relative z-20">
                    <div className="w-full max-w-5xl flex justify-between items-center mb-16 border-b border-white/10 pb-4">
                        <div className="flex items-center gap-2">
                            <div className="w-3 h-3 bg-cyan-400 rounded-full animate-pulse"></div>
                            <h1 className="cinzel-font text-xl md:text-2xl font-bold tracking-widest text-white">MOODOGRAM</h1>
                        </div>
                        <span className="mono-font text-xs text-white/50">V.4.2.0 // BETA</span>
                    </div>

                    <div className="w-full max-w-4xl text-center mb-10">
                        <h2 className="inter-font text-4xl md:text-7xl font-extrabold tracking-tight mb-6 bg-clip-text text-transparent bg-gradient-to-r from-cyan-300 via-lime-300 to-orange-300">
                            Decoding the Subconscious.
                        </h2>
                        {/* Modified Quote */}
                        <p className="cinzel-font italic text-lg md:text-2xl text-transparent bg-clip-text bg-gradient-to-r from-amber-200 via-yellow-400 to-amber-600 font-bold max-w-3xl mx-auto leading-relaxed mb-8 drop-shadow-[0_0_8px_rgba(234,179,8,0.5)]">
                            "In a world of constant noise, your true emotions are often silent. We listen to that silence."
                        </p>
                        <button onClick={scrollToBottom} className="px-6 py-2 border border-white/20 rounded-full text-sm font-bold tracking-wider hover:bg-white hover:text-black transition-all duration-300">TRY NOW ↓</button>
                    </div>

                    <div className="w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 gap-6 mb-24">
                        <div className="glass-panel rounded-3xl p-8 flex flex-col justify-between hover:bg-white/5 transition-colors">
                            <div>
                                <h3 className="mono-font text-cyan-400 text-sm mb-2">THE PROBLEM</h3>
                                <h4 className="inter-font text-2xl font-bold mb-4">Emotional Latency</h4>
                                <p className="text-gray-400 text-sm leading-relaxed">
                                    Modern life forces a disconnect between stimulus and emotional response. 
                                    Traditional mood tracking relies on conscious input, which is often biased.
                                </p>
                            </div>
                        </div>
                        <div className="glass-panel rounded-3xl p-8 flex flex-col justify-between hover:bg-white/5 transition-colors">
                            <div>
                                <h3 className="mono-font text-lime-400 text-sm mb-2">THE SOLUTION</h3>
                                <h4 className="inter-font text-2xl font-bold mb-4">Poly-phasic Biometrics</h4>
                                <p className="text-gray-400 text-sm leading-relaxed">
                                    Moodogram utilizes proprietary heuristic algorithms to measure micro-hesitations 
                                    in motor reflexes, mapping them directly to the Limbic Resonance Spectrum.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div className="w-full max-w-5xl mb-32">
                        <h3 className="mono-font text-center text-white/40 mb-16 text-xs tracking-[0.3em]">ANALYSIS PIPELINE</h3>
                        <div className="flex flex-col gap-24">
                            <div className="flex flex-col md:flex-row items-center gap-12">
                                <div className="flex-1 text-center md:text-left order-2 md:order-1">
                                    <div className="text-cyan-400 mono-font text-xs mb-2">STAGE 01</div>
                                    <h3 className="text-3xl font-bold mb-4">Neural Calibration</h3>
                                    <p className="text-gray-400 leading-relaxed">We establish a baseline by measuring motor-reflex latency.</p>
                                </div>
                                <div className="flex-1 w-full max-w-xs h-48 dark-glass-panel rounded-xl flex items-center justify-center p-4 order-1 md:order-2 cursor-crosshair overflow-visible" onMouseEnter={handleKeysHover} onMouseLeave={handleKeysLeave}>
                                    <DiagramKeys />
                                </div>
                            </div>
                            <div className="flex flex-col md:flex-row items-center gap-12">
                                <div className="flex-1 w-full max-w-xs h-48 dark-glass-panel rounded-xl flex items-center justify-center p-4 cursor-crosshair overflow-hidden" onMouseEnter={handleStimulusHover}>
                                    <DiagramStimulus activeStage={stimulusStage} />
                                </div>
                                <div className="flex-1 text-center md:text-left">
                                    <div className="text-lime-400 mono-font text-xs mb-2">STAGE 02</div>
                                    <h3 className="text-3xl font-bold mb-4">Visual Stimulus</h3>
                                    <p className="text-gray-400 leading-relaxed">Subconscious reaction to abstract geometric patterns reveals underlying stress markers.</p>
                                </div>
                            </div>
                            <div className="flex flex-col md:flex-row items-center gap-12">
                                <div className="flex-1 text-center md:text-left order-2 md:order-1">
                                    <div className="text-orange-400 mono-font text-xs mb-2">STAGE 03</div>
                                    <h3 className="text-3xl font-bold mb-4">Predictive Synthesis</h3>
                                    <p className="text-gray-400 leading-relaxed">All data points are fed into our neural engine to construct a profile.</p>
                                </div>
                                <div className="flex-1 w-full max-w-xs h-48 dark-glass-panel rounded-xl flex items-center justify-center p-4 order-1 md:order-2 cursor-crosshair overflow-hidden" onMouseEnter={handleNetworkHover} onMouseLeave={handleNetworkLeave}>
                                    <DiagramNetwork />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div ref={proceedButtonRef} className="mb-20 text-center">
                        <button onClick={onStart} className="group relative px-8 py-4 bg-white text-black rounded-full font-bold inter-font tracking-wide overflow-hidden transition-transform hover:scale-105 active:scale-95 shadow-[0_0_40px_rgba(255,255,255,0.3)]">
                            <span className="relative z-10 flex items-center gap-2">PROCEED TO STAGE 1 <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg></span>
                            <div className="absolute inset-0 bg-gradient-to-r from-cyan-400 via-lime-400 to-orange-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        </button>
                        <p className="mt-4 mono-font text-[10px] text-gray-500">Estimated duration: 2 minutes • Headphones recommended</p>
                    </div>
                    <div className="w-full text-center border-t border-white/5 pt-8"><p className="mono-font text-[10px] text-gray-600">© 2025 MOODOGRAM LABS. ALL RIGHTS RESERVED.</p></div>
                </div>
            );
        };

        // --- FINAL STAGE COMPONENT ---
        const FinalStage = () => {
            const [hoveredSide, setHoveredSide] = useState(null);
            
            // Swapped the quote content
            const leftQuote = "A life is a Tragedy in close-up and a Comedy in long-shot. So watch yourself out there";
            const rightQuote = "Nothing is permanent in this wicked world – not even your troubles.";

            return (
                <div className="absolute inset-0 w-full h-full bg-black flex flex-col items-center justify-center overflow-hidden animate-fade-in">
                    {/* Starry Background */}
                    <StarryBackground />
                    
                    {/* Center Button */}
                    <div className="z-30 text-center relative">
                        <a 
                            href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" 
                            target="_blank" 
                            className="group relative inline-flex items-center justify-center px-8 py-4 font-bold text-black transition-all duration-300 bg-white rounded-full inter-font tracking-wide overflow-hidden hover:scale-105"
                        >
                            <span className="relative z-10">You've come a long way, click here to rest</span>
                            <div className="absolute inset-0 bg-gradient-to-r from-cyan-400 via-lime-400 to-orange-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        </a>
                    </div>

                    {/* Left Peeking Image - Responsive Scale */}
                    <div 
                        className="absolute -bottom-10 -left-10 w-[40vw] h-[40vw] max-w-[600px] max-h-[600px] cursor-pointer z-20 transition-transform duration-500 hover:scale-105 hover:z-30"
                        onMouseEnter={() => setHoveredSide('left')}
                        onMouseLeave={() => setHoveredSide(null)}
                        style={{ transform: 'rotate(10deg)' }}
                    >
                        <img 
                            src="https://i.ibb.co/Sp02GS0/Saanya-Farewell.png" 
                            alt="Left Peek" 
                            className="w-full h-full object-contain drop-shadow-[0_0_20px_rgba(255,255,255,0.3)]" 
                        />
                        
                        {/* Glass Speech Bubble - Now shows the "Tragedy/Comedy" quote with the underline styling */}
                        <div className={`absolute bottom-full left-10 mb-4 w-64 p-4 glass-panel rounded-xl text-white text-sm cinzel-font transition-all duration-500 ${hoveredSide === 'left' ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4 pointer-events-none'}`}>
                            "A life is a Tragedy in close-up and a Comedy in long-shot. So <span className="underline-watch font-bold">watch</span> yourself out there"
                        </div>
                    </div>

                    {/* Right Peeking Image - Fixed Positioning for Bubble Visibility */}
                    <div 
                        className="absolute -bottom-10 -right-[15vw] w-[40vw] h-[40vw] max-w-[600px] max-h-[600px] cursor-pointer z-20 transition-transform duration-500 hover:scale-105 hover:z-30"
                        onMouseEnter={() => setHoveredSide('right')}
                        onMouseLeave={() => setHoveredSide(null)}
                        style={{ transform: 'rotate(-10deg)' }}
                    >
                        <img 
                            src="https://i.ibb.co/qLkHRzZ3/Saanya-Pilot.png" 
                            alt="Right Peek" 
                            className="w-full h-full object-contain drop-shadow-[0_0_20px_rgba(255,255,255,0.3)]" 
                        />
                        
                        {/* Glass Speech Bubble - Pushed to the LEFT of the container to be visible - Now shows the "Wicked World" quote */}
                        <div className={`absolute bottom-full left-0 mb-4 w-64 p-4 glass-panel rounded-xl text-white text-sm cinzel-font text-left transition-all duration-500 ${hoveredSide === 'right' ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4 pointer-events-none'}`}>
                            "{rightQuote}"
                        </div>
                    </div>
                </div>
            );
        };

        const Stage1Game = ({ onComplete }) => {
            const [gameState, setGameState] = useState('idle');
            const [currentKeyIndex, setCurrentKeyIndex] = useState(0);
            const [activeKeys, setActiveKeys] = useState(new Set());
            const [targetKey, setTargetKey] = useState(null);
            const [charQueue, setCharQueue] = useState([]);
            
            const keyboardRef = useRef(null);
            const finalContainerRef = useRef(null); 

            useEffect(() => {
                const shuffled = [...UNIQUE_CHARS].sort(() => Math.random() - 0.5);
                setCharQueue(shuffled);
            }, []);

            useEffect(() => {
                const handleKeyDown = (e) => {
                    const pressedKey = e.key.toUpperCase();
                    if (gameState === 'idle' && pressedKey === ' ') startGame();
                    else if (gameState === 'playing') handleGameInput(pressedKey);
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [gameState, targetKey, charQueue]);

            const startGame = () => {
                setGameState('playing');
                setTargetKey(charQueue[0]);
            };

            const handleGameInput = (inputChar) => {
                if (!targetKey) return;
                if (inputChar === targetKey) {
                    const newActiveKeys = new Set(activeKeys);
                    newActiveKeys.add(inputChar);
                    setActiveKeys(newActiveKeys);
                    
                    const nextIndex = currentKeyIndex + 1;
                    if (nextIndex < charQueue.length) {
                        setCurrentKeyIndex(nextIndex);
                        setTargetKey(charQueue[nextIndex]);
                    } else {
                        setTargetKey(null);
                        setGameState('finished');
                        setTimeout(animateFloatingLetters, 500);
                    }
                }
            };

            // Jitter on Hover for Stage 1 Game
            const handleMouseEnter = (e) => {
                if (gameState === 'finished') return;
                gsap.to(e.target, {
                    x: "random(-2, 2)",
                    y: "random(-2, 2)",
                    rotation: "random(-5, 5)",
                    duration: 0.05,
                    repeat: -1,
                    yoyo: true,
                    ease: "power1.inOut"
                });
            };

            const handleMouseLeave = (e) => {
                if (gameState === 'finished') return;
                gsap.killTweensOf(e.target);
                gsap.to(e.target, { x: 0, y: 0, rotation: 0, duration: 0.2 });
            };

            const animateFloatingLetters = () => {
                if (!window.gsap) return;
                const timeline = gsap.timeline();
                const finalChars = finalContainerRef.current.querySelectorAll('.final-char');
                
                timeline.to('.instruction-content', { opacity: 0, duration: 0.5 });
                timeline.to('.key.active', { 
                    textShadow: "0 0 20px #FFD700, 0 0 40px #FFD700", 
                    borderColor: "#FFD700", 
                    boxShadow: "0 0 20px #FFD700", 
                    duration: 0.5 
                });

                finalChars.forEach((targetNode) => {
                    const char = targetNode.innerText;
                    if (char === ' ') return; 

                    const keyElement = document.getElementById(`key-${char}`);
                    if (!keyElement) return;

                    const startRect = keyElement.getBoundingClientRect();
                    const endRect = targetNode.getBoundingClientRect();

                    const flyer = document.createElement('div');
                    flyer.innerText = char;
                    
                    Object.assign(flyer.style, {
                        position: 'fixed',
                        left: `${startRect.left}px`,
                        top: `${startRect.top}px`,
                        width: `${startRect.width}px`,
                        height: `${startRect.height}px`,
                        display: 'flex', justifyContent: 'center', alignItems: 'center',
                        color: '#FFD700', fontFamily: "'Cinzel', serif", fontWeight: 'bold', fontSize: '1.25rem',
                        zIndex: '50', textShadow: "0 0 10px #FFD700", pointerEvents: 'none'
                    });
                    
                    document.body.appendChild(flyer);

                    gsap.to(flyer, {
                        x: (endRect.left - startRect.left) + (endRect.width / 2 - startRect.width / 2),
                        y: (endRect.top - startRect.top),
                        scale: 1.5, duration: 1.5, ease: "power3.inOut",
                        delay: Math.random() * 0.5,
                        onComplete: () => {
                            gsap.to(targetNode, { opacity: 1, duration: 0.2 });
                            flyer.remove();
                        }
                    });
                });

                timeline.to('#keyboard', { opacity: 0.2, filter: 'blur(5px)', duration: 2 }, "-=1");
                setTimeout(() => {
                    setTimeout(onComplete, 2000); 
                }, 1500);
            };

            return (
                <div className="flex flex-col items-center justify-center min-h-screen w-full relative p-4">
                     {/* INSTRUCTION CONTENT - Cleaned layout */}
                    <div className="instruction-content flex flex-col items-center max-w-5xl text-center mb-10">
                        <h1 className="text-white text-xl md:text-3xl font-extrabold tracking-widest uppercase mb-4 cinzel-font border-b border-gray-800 pb-2">
                            Stage - 1 : Reaction Calibration
                        </h1>
                        <p className="text-gray-400 text-xs mono-font mb-6">
                            Follow the visual cues. Strike the illuminated keys immediately.
                        </p>
                        <h2 className="text-lg md:text-2xl cinzel-font text-yellow-400 font-bold glow-text max-w-xl leading-relaxed italic mb-8">
                            "Look for the light in the overwhelming darkness"
                        </h2>
                        
                        {/* Spacebar Instruction ABOVE Keyboard */}
                        {gameState === 'idle' && (
                             <div className="animate-pulse cursor-pointer mb-4" onClick={startGame}>
                                <p className="mono-font text-emerald-500 text-xs border border-emerald-900/50 bg-emerald-900/10 px-6 py-3 rounded tracking-widest">
                                    [ PRESS SPACEBAR TO INITIALIZE ]
                                </p>
                            </div>
                        )}
                         {gameState === 'playing' && (
                            <p className="mono-font text-emerald-400 text-xs animate-pulse mb-4">• RECORDING INPUT STREAM •</p>
                        )}
                    </div>

                    {/* KEYBOARD - Scaled comfortably */}
                    <div id="keyboard" ref={keyboardRef} className="instruction-content relative z-10 p-2 border border-gray-900 rounded-xl bg-gray-950/50 backdrop-blur-sm shadow-2xl scale-100 lg:scale-125 mb-10">
                        <div className="flex flex-col gap-1 items-center">
                            {KEYBOARD_LAYOUT.map((row, rowIndex) => (
                                <div key={rowIndex} className="flex gap-1">
                                    {row.map((char) => {
                                        const isTarget = char === targetKey;
                                        const isActive = activeKeys.has(char);
                                        return (
                                            <button 
                                                key={char} 
                                                id={`key-${char}`} 
                                                className={`key relative w-8 h-10 md:w-12 md:h-14 flex items-center justify-center rounded border border-gray-800 bg-gray-900/80 text-gray-600 font-bold text-xs md:text-lg select-none ${isTarget ? 'current-target' : ''} ${isActive ? 'active' : ''}`} 
                                                onClick={() => gameState === 'playing' ? handleGameInput(char) : null}
                                                onMouseEnter={handleMouseEnter}
                                                onMouseLeave={handleMouseLeave}
                                            >
                                                {char}
                                            </button>
                                        );
                                    })}
                                </div>
                            ))}
                            <div className="mt-1 w-full max-w-md h-10 border border-gray-800 rounded bg-gray-900/80 flex items-center justify-center text-gray-700 text-[10px] tracking-widest">SPACE</div>
                        </div>
                    </div>

                    {/* FINAL MESSAGE CONTAINER */}
                    <div ref={finalContainerRef} className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20 w-full text-center pointer-events-none">
                        <div className="cinzel-font font-bold text-yellow-400 text-3xl md:text-6xl lg:text-7xl glow-text flex flex-wrap justify-center gap-x-4 md:gap-x-8">
                            {TARGET_PHRASE.split(' ').map((word, wIdx) => (
                                <div key={wIdx} className="flex">
                                    {word.split('').map((char, cIdx) => (
                                        <span key={`${wIdx}-${cIdx}`} className="final-char inline-block opacity-0" style={{ width: char === 'I' ? 'auto' : '1.2em' }}>{char}</span>
                                    ))}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('intro'); 
            const [showFinal, setShowFinal] = useState(false);
            
            const stage1ContainerRef = useRef(null); 
            const trainContainerRef = useRef(null); 
            
            const handleStart = () => {
                gsap.to('.intro-container', {
                    opacity: 0,
                    duration: 1,
                    onComplete: () => setView('stage1')
                });
            };

            const runTrainSequence = () => {
                const tl = gsap.timeline();
                const trainContainer = trainContainerRef.current;
                const stage1 = stage1ContainerRef.current;
                
                gsap.set(trainContainer, { display: 'block', x: '-100vw', xPercent: 0 });
                
                // 1. Peek
                tl.to(trainContainer, { x: '0vw', xPercent: 0, duration: 1.5, ease: "power2.out" })
                  .to(trainContainer, { x: '20px', duration: 1.5, ease: "none" });

                // 2. Arrive Center
                tl.to(trainContainer, { x: '50vw', xPercent: -50, duration: 2.5, ease: "power1.in" });
                
                // 3. Travel
                tl.to(stage1, { x: '-100vw', duration: 3, ease: "none" });
                
                // 4. Depart
                tl.to(trainContainer, { x: '150vw', duration: 3, ease: "none" });

                tl.call(() => setShowFinal(true));
            };

            return (
                <div className="relative w-full h-full overflow-hidden font-sans">
                    {/* Tech Decor */}
                    <div className="absolute top-4 right-4 text-[10px] mono-font text-emerald-500/70 text-right pointer-events-none z-50 mix-blend-screen">
                        SYS.STATUS: ONLINE<br/>NEURAL.LINK: ACTIVE<br/>V.4.2.0
                    </div>

                    {/* Background Blobs (Intro Only) */}
                    {view === 'intro' && <BackgroundBlobs />}

                    {/* INTRO */}
                    {view === 'intro' && (
                        <div className="intro-container absolute inset-0 z-30">
                            <IntroPage onStart={handleStart} />
                        </div>
                    )}

                    {/* STAGE 1 */}
                    {view === 'stage1' && !showFinal && (
                        <div ref={stage1ContainerRef} className="absolute inset-0 w-full h-full bg-black">
                            <Stage1Game onComplete={runTrainSequence} />
                        </div>
                    )}

                    {/* TRAIN CONTAINER */}
                    <div ref={trainContainerRef} className="fixed bottom-10 left-0 w-64 md:w-96 z-40 hidden pointer-events-none">
                        <img src="https://i.ibb.co/nNYP59pd/Saanya-Train-Engine.png" alt="Magic Train" className="train-engine w-full h-full object-contain" />
                    </div>

                    {/* FINAL STAGE */}
                    {showFinal && <FinalStage />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>